<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Repatha® Copay Card Enrollment | SaveRx.ai</title>
  <meta name="description" content="Quick 2-step enrollment for the Repatha copay card (commercial insurance only). Not affiliated with the manufacturer." />
  <link rel="icon" href="../assets/favicon.svg" />
  <link rel="stylesheet" href="../styles.css" />
  <style>
    /* Light enhancements using site tokens */
    .enroll-hero { background: var(--card); padding: 1.4rem 0; }
    .steps { display:flex; gap:.4rem; margin:.75rem 0 0; }
    .step { flex:1; height:6px; background:var(--border); border-radius:999px; overflow:hidden; }
    .step > span { display:block; height:100%; background:var(--brand); width:0%; transition:width .25s ease; }
    .step--active > span { width:100%; }
    .field-grid { display:grid; grid-template-columns:1fr 1fr; gap:.8rem; }
    @media (max-width: 800px){ .field-grid { grid-template-columns:1fr; } }
    .hint { color: var(--muted); font-size:.9rem; margin:.25rem 0 0; }
    .elig { background: #F2F8FF; border:1px solid var(--border); color:#0A2A4A; padding:.75rem; border-radius:.6rem; font-size:.9rem; }
    .error { background:#FFF5F5; border:1px solid #ffd1d1; color:#8a1f1f; padding:.6rem .7rem; border-radius:.5rem; font-size:.9rem; display:none; }
    .actions { display:flex; justify-content:flex-end; gap:.6rem; margin-top:.6rem; }
    .success { text-align:center; padding:1rem; display:none; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="../index.html">
        <img src="../assets/logo.svg" alt="SaveRx.ai logo" class="brand-logo" />
        <span class="brand-name">SaveRx.ai</span>
      </a>
      <nav class="top-nav" aria-label="Main">
        <a href="../index.html#how">How It Works</a>
        <a href="../index.html#coverage">Coverage</a>
        <a href="../index.html#early-access">Early Access</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="enroll-hero" aria-labelledby="enroll-title">
      <div class="container">
        <h1 id="enroll-title" class="h2">Repatha® Copay Card – Enrollment</h1>
        <p class="note-small">2 quick steps. For commercially insured patients only.</p>
        <div class="steps" aria-hidden="true">
          <div class="step step--active" id="s1"><span></span></div>
          <div class="step" id="s2"><span></span></div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div class="panel">
          <div id="formWrap">
            <form id="repathaForm" class="form" autocomplete="on">
              <!-- STEP 1 -->
              <section id="step1">
                <p class="elig">
                  Eligibility: Only patients with <strong>commercial insurance</strong> may be eligible.
                  Patients covered by government programs (e.g., Medicare/Medicaid) are <strong>not</strong> eligible.
                </p>

                <div class="field-grid">
                  <div class="field">
                    <label for="firstName" class="label">First Name</label>
                    <input id="firstName" name="firstName" class="input" required placeholder="First" autocomplete="given-name" />
                  </div>
                  <div class="field">
                    <label for="lastName" class="label">Last Name</label>
                    <input id="lastName" name="lastName" class="input" required placeholder="Last" autocomplete="family-name" />
                  </div>
                </div>

                <div class="field-grid">
                  <div class="field">
                    <label for="dob" class="label">Date of Birth</label>
                    <input id="dob" name="dob" type="date" class="input" required />
                  </div>
                  <div></div>
                </div>

                <div class="field">
                  <label for="address" class="label">Address</label>
                  <input id="address" name="address" class="input" required placeholder="Street address" autocomplete="address-line1" />
                </div>

                <div class="field-grid">
                  <div class="field">
                    <label for="city" class="label">City</label>
                    <input id="city" name="city" class="input" required autocomplete="address-level2" />
                  </div>
                  <div class="field">
                    <label for="state" class="label">State/Province</label>
                    <input id="state" name="state" class="input" required autocomplete="address-level1" />
                  </div>
                </div>

                <div class="field-grid">
                  <div class="field">
                    <label for="zip" class="label">ZIP/Postal Code</label>
                    <input id="zip" name="zip" class="input" required inputmode="numeric" autocomplete="postal-code" />
                  </div>
                  <div class="field">
                    <label for="phone" class="label">Phone</label>
                    <input id="phone" name="phone" class="input" required inputmode="tel" placeholder="(###) ###-####" />
                  </div>
                </div>

                <div class="field-grid">
                  <div class="field">
                    <label for="email" class="label">Email</label>
                    <input id="email" name="email" type="email" class="input" required placeholder="you@example.com" autocomplete="email" />
                  </div>
                  <div class="field">
                    <label for="insuranceStatus" class="label">Insurance Status</label>
                    <select id="insuranceStatus" name="insuranceStatus" class="input" required>
                      <option value="">Select…</option>
                      <option value="commercial">Commercial</option>
                      <option value="medicare">Medicare</option>
                      <option value="medicaid">Medicaid</option>
                      <option value="uninsured">Uninsured</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                </div>

                <div class="error" id="eligError">Sorry, only commercially insured patients are eligible for this copay program.</div>

                <div class="actions">
                  <button type="button" class="btn" id="nextBtn">Next</button>
                </div>
              </section>

              <!-- STEP 2 -->
              <section id="step2" style="display:none;">
                <div class="field">
                  <label class="checkbox">
                    <input type="checkbox" id="confirmEligibility" name="confirmEligibility" required />
                    <span>I confirm that I have commercial insurance and meet the eligibility requirements.</span>
                  </label>
                </div>

                <div class="field">
                  <label class="checkbox">
                    <input type="checkbox" id="consent" name="consent" required />
                    <span>I authorize the use of my information to enroll me in the Repatha® Copay Card program and agree to the privacy policy.</span>
                  </label>
                </div>

                <div class="field">
                  <label class="checkbox">
                    <input type="checkbox" id="optIn" name="optIn" />
                    <span>Yes, I’d like to receive therapy updates and support services.</span>
                  </label>
                </div>

                <p class="hint">By submitting, you consent to program terms. Program terms may change at any time.</p>

                <!-- Honeypot -->
                <div style="position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden;">
                  <label for="website">Website</label>
                  <input id="website" name="website" autocomplete="off" />
                </div>

                <!-- metadata -->
                <input type="hidden" name="userAgent" id="userAgent" />
                <input type="hidden" name="referrer" id="referrer" />

                <div class="actions">
                  <button type="button" class="btn btn-secondary" id="backBtn">Back</button>
                  <button type="submit" class="btn btn-primary" id="submitBtn">Submit & Finish</button>
                </div>
              </section>
            </form>
          </div>

          <div class="success" id="success">
            <h3 class="h3">Thanks! Your information has been received.</h3>
            <p class="note-small">We’ll email next steps. If you qualify, you’ll receive your copay card details shortly.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer" aria-labelledby="footer-title">
    <div class="container footer-inner">
      <h2 class="sr-only" id="footer-title">Site information</h2>
      <p>© <span id="year"></span> SaveRx.ai</p>
    </div>
  </footer>

  <script src="../scripts.js"></script>
  <script>
    // ==== CONFIG: Apps Script Web App URL ====
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyNUPxR1j2q42KLBGOFUfRZGrKOoZVF89-hiwh90EV4F6wvWsDtY15muRrmGXwjT1sNrA/exec';

    // Elements
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const nextBtn = document.getElementById('nextBtn');
    const backBtn = document.getElementById('backBtn');
    const s1Bar = document.getElementById('s1');
    const s2Bar = document.getElementById('s2');
    const eligError = document.getElementById('eligError');
    const insurance = document.getElementById('insuranceStatus');
    const form = document.getElementById('repathaForm');
    const success = document.getElementById('success');

    const phone = document.getElementById('phone');
    const zip = document.getElementById('zip');
    const emailField = document.getElementById('email');

    // meta
    document.getElementById('userAgent').value = navigator.userAgent;
    document.getElementById('referrer').value = document.referrer || location.href;

    // Prefill email from ?email=...
    const params = new URLSearchParams(location.search);
    if (params.get('email')) {
      emailField.value = params.get('email');
    }

    // Input masks
    phone.addEventListener('input', () => {
      const digits = phone.value.replace(/\D/g, '').slice(0,10); // US 10-digit
      let out = digits;
      if (digits.length > 6) out = `(${digits.slice(0,3)}) ${digits.slice(3,6)}-${digits.slice(6)}`;
      else if (digits.length > 3) out = `(${digits.slice(0,3)}) ${digits.slice(3)}`;
      else if (digits.length > 0) out = `(${digits}`;
      phone.value = out;
    });

    zip.addEventListener('input', () => {
      const digits = zip.value.replace(/\D/g, '').slice(0,9); // ZIP or ZIP+4
      zip.value = digits.length > 5 ? `${digits.slice(0,5)}-${digits.slice(5)}` : digits;
    });

    function goStep2() {
      step1.style.display = 'none';
      step2.style.display = 'block';
      s1Bar.classList.add('step--active');
      s2Bar.classList.add('step--active');
      eligError.style.display = 'none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    function goStep1() {
      step2.style.display = 'none';
      step1.style.display = 'block';
      s2Bar.classList.remove('step--active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    nextBtn.addEventListener('click', () => {
      const requiredIds = ['firstName','lastName','dob','address','city','state','zip','phone','email','insuranceStatus'];
      for (const id of requiredIds) {
        const el = document.getElementById(id);
        if (!el.value || (el.tagName === 'SELECT' && el.value === '')) {
          el.focus();
          return;
        }
      }
      if (insurance.value !== 'commercial') {
        eligError.style.display = 'block';
        return;
      }
      goStep2();
    });

    backBtn.addEventListener('click', goStep1);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.classList.add('is-loading');

      try {
        const fd = new FormData(form);
        const res = await fetch(SCRIPT_URL, { method: 'POST', body: fd });
        if (res.ok) {
          document.getElementById('formWrap').style.display = 'none';
          success.style.display = 'block';
          setTimeout(() => { window.location.href = '../pharmacy.html'; }, 900);
        } else {
          alert('Submission failed. Please try again.');
          submitBtn.disabled = false;
          submitBtn.classList.remove('is-loading');
        }
      } catch (err) {
        alert('Network error. Please try again.');
        submitBtn.disabled = false;
        submitBtn.classList.remove('is-loading');
      }
    });
  </script>
</body>
</html>
