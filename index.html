<!doctype html>
<html lang="en">
<head>
  <!-- =========================================================
       SaveRx.ai — Homepage (MVP, no on-page search)
       Notes:
       - Uses a tiny helper (at the end of <body>) to append a
         cache-busting version to CSS/JS (no manual bumps).
       - All links are RELATIVE to work on GitHub Pages:
         https://vajih.github.io/saverx/index.html
       ========================================================= -->

  <meta charset="utf-8" />
  <title>SaveRx.ai — Stop paying too much for prescriptions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="Compare prices and save on popular prescriptions like Repatha, Ozempic, Wegovy, Mounjaro, and Stelara. Official manufacturer savings links and simple guidance." />
  <meta name="robots" content="index, follow" />

  <!-- Open Graph / Social -->
  <meta property="og:title" content="SaveRx.ai — Lower Your Out-of-Pocket" />
  <meta property="og:description" content="Find official savings and copay programs for top medications." />
  <meta property="og:image" content="https://vajih.github.io/saverx/assets/img/hero-1200.jpg" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://vajih.github.io/saverx/index.html" />
  <link rel="canonical" href="https://vajih.github.io/saverx/index.html" />

  <!-- Favicon -->
  <link rel="icon" href="assets/img/favicon.png" />

  <!-- CSS is set dynamically by the tiny helper (cache-busted) -->
  <link id="cssLink" rel="stylesheet" href="">
</head>

<body class="theme-light">
  <!-- =======================
       Header / Primary Nav
       ======================= -->
  <header class="site-header" role="banner">
    <div class="header-row">
      <a class="brand" href="index.html" aria-label="SaveRx.ai home">SaveRx.ai</a>

      <!-- Mobile menu icon (optional) -->
      <button class="menu-btn" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-drawer">
        ☰
      </button>

      <!-- Desktop nav (hidden on mobile) -->
      <nav class="site-nav" aria-label="Primary">
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Optional mobile drawer -->
  <aside id="mobile-drawer" class="mobile-drawer" hidden>
    <nav aria-label="Mobile">
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </aside>

  <!-- =======================
       Hero
       ======================= -->
  <section class="hero container text-center">
    <h1 class="hero-title">Stop paying too much for prescriptions</h1>
    <p class="hero-subtitle">Find official manufacturer savings and lower your out-of-pocket.</p>
    <!-- (Search removed for MVP) -->
  </section>

  <!-- =======================
       Featured drug cards
       Rendered live from Google Sheet via Apps Script
       ======================= -->
  <section class="container section-pad">
    <h2 class="section-title">Featured</h2>

    <div id="featured-cards" class="cards" role="list" aria-live="polite">
      <!-- JS injects cards here -->
    </div>

    <div id="cards-loading" class="text-center muted small" aria-live="polite">
      Loading savings…
    </div>

    <!-- (Optional) Simple pagination stub for now -->
    <div class="text-center muted small" aria-hidden="true">
      <span>‹</span>
      <span style="margin:0 8px;">1 of 2</span>
      <span>›</span>
    </div>

    <noscript>
      <p class="muted small">JavaScript is required to load the latest Featured savings.</p>
    </noscript>
  </section>

<!-- ==== Request Medication section =======-->

<!-- Request a medication (MVP lead capture) -->
<section id="request-med" class="container section-pad">
  <h2 class="section-title">Don’t see your medication?</h2>
  <p class="muted">Tell us what you need and we’ll email you when we add it.</p>

  <form id="request-form" class="request-form" action="" method="get" novalidate>
    <label class="visually-hidden" for="request-drug">Medication name</label>
    <input type="text" id="request-drug" name="drug" placeholder="Medication name (e.g., Mounjaro)" required aria-label="Medication name">

    <label class="visually-hidden" for="request-email">Email address</label>
    <input type="email" id="request-email" name="email" placeholder="you@example.com" required aria-label="Email address">

    <button type="submit" class="btn btn-primary">Notify me</button>
    <p id="request-hint" class="form-hint"></p>
  </form>
</section>



  <!-- =======================
       Newsletter CTA
       ======================= -->
  <section class="newsletter">
    <div class="container text-center">
      <h2>Good news for your inbox</h2>
      <p class="muted">Sign up for tips and new medication savings as we add them.</p>

      <!-- Keep # for now; wire to Apps Script later if you want -->
      <form action="#" method="post" class="newsletter-form">
        <label for="newsletter-email" class="visually-hidden">Email address</label>
        <input id="newsletter-email" type="email" name="email" placeholder="Email address" required />
        <button type="submit" class="btn btn-primary">Subscribe</button>
      </form>

      <div class="contact-block">
        <h3>Contact Us</h3>
        <p><a href="mailto:questions@saverx.ai">questions@saverx.ai</a></p>
      </div>
    </div>
  </section>

  <!-- =======================
       Footer
       ======================= -->
  <footer class="container footer" aria-label="Footer">
    <p class="muted">&copy; <script>document.write(new Date().getFullYear());</script> SaveRx.ai</p>
  </footer>

  <!-- Provide the Apps Script URL (single source of truth) -->
  <script>
    window.PAGE_CONFIG = {
      // Your deployed Web App URL (ends with /exec)
      scriptUrl: "https://script.google.com/macros/s/AKfycbzJUp5EXbJ7_BS8OV4Bm--khDRZU4WmP4R7wH3vbNupz9oimHcQvXAXOWgypeGN-au3Cg/exec"
    };
  </script>

  <!-- Tiny fallback: if assets/scripts.js doesn't define renderFeaturedDrugs(),
       this will render from ?mode=featured so MVP still works. -->
  <script>
    window.renderFeaturedDrugs = window.renderFeaturedDrugs || (async function defaultRenderFeaturedDrugs(feedUrl){
      const container = document.getElementById('featured-cards');
      const loadingEl = document.getElementById('cards-loading');
      try {
        const res = await fetch(feedUrl);
        const json = await res.json();
        const items = (json && json.items) || [];
        if (loadingEl) loadingEl.style.display = 'none';
        if (!container) return;

        if (!items.length) {
          container.innerHTML = '<p class="muted small">No Featured medications configured yet.</p>';
          return;
        }

        const escape = s => (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
        container.innerHTML = items.map(item => {
          const name = escape(item.name);
          const generic = item.generic ? ` (${escape(item.generic)})` : '';
          const mfr = escape(item.manufacturer || '');
          const url = item.url || '#';
          const asLow = (item.as_low_as != null && !isNaN(Number(item.as_low_as)))
            ? `As low as $${Number(item.as_low_as).toLocaleString()}`
            : '';
          return `
            <article class="card drug-card" role="listitem">
              <div class="card-body">
                <h3 class="drug-title">${name}${generic}</h3>
                <p class="drug-subtitle">${mfr}${asLow ? ' • ' + asLow : ''}</p>
                <a class="btn" href="${url}">Get Savings</a>
              </div>
            </article>
          `;
        }).join('');
      } catch (err) {
        if (loadingEl) loadingEl.textContent = 'Could not load savings.';
        console.error('Featured load error:', err);
      }
    });
  </script>

  <!-- =========================================================
       Tiny helper:
       - Sets CSS/JS URLs with a date version to bust cache
       - Loads scripts.js THEN calls renderFeaturedDrugs()
       ========================================================= -->
  <script>
    (function () {
      // Version string (YYYY-MM-DD). Use Date.now() for per-load busting.
      var v = new Date().toISOString().slice(0, 10);

      // 1) Load CSS with cache-buster
      document.getElementById('cssLink').href = 'assets/styles.css?v=' + v;

      // 2) Load JS with cache-buster, then initialize cards
      var s = document.createElement('script');
      s.src = 'assets/scripts.js?v=' + v;
      s.onload = function () {
        if (window.renderFeaturedDrugs) {
          window.renderFeaturedDrugs(
            // Use your Featured JSON feed
            (window.PAGE_CONFIG && window.PAGE_CONFIG.scriptUrl ? window.PAGE_CONFIG.scriptUrl : '') + '?mode=featured'
          );
        }
      };
      document.body.appendChild(s);
    })();
  </script>

  <!-- Structured data (Website only; search action removed for MVP) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "SaveRx.ai",
    "url": "https://vajih.github.io/saverx/index.html"
  }
  </script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.querySelector('.newsletter-form');
  if (!form) { console.warn('[newsletter] form not found'); return; }

  const emailInput = form.querySelector('input[type="email"]');
  const submitBtn  = form.querySelector('button[type="submit"]');

  // Belt & suspenders: ensure the form itself never navigates
  form.setAttribute('action', '');
  form.setAttribute('method', 'get');  // GET on a static page is safe if JS fails

  // status line
  function showMessage(msg) {
    let hint = form.querySelector('.form-hint');
    if (!hint) {
      hint = document.createElement('p');
      hint.className = 'form-hint';
      form.appendChild(hint);
    }
    hint.textContent = msg;
  }

  // serializer
  const toForm = (data) =>
    Object.entries(data)
      .map(([k, v]) => encodeURIComponent(k) + '=' + encodeURIComponent(v))
      .join('&');

  console.log('[newsletter] handler attached');

  form.addEventListener('submit', async function (e) {
    e.preventDefault();
    e.stopPropagation();

    const email = (emailInput.value || '').trim();
    if (!email) { showMessage('Please enter a valid email.'); emailInput.focus(); return false; }

    const originalText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = 'Saving…';

    try {
      const scriptUrl = (window.PAGE_CONFIG && window.PAGE_CONFIG.scriptUrl) || '';
      const body = toForm({
        email,
        drug: '',
        source: 'newsletter_home',
        // match your backend param name: useragent (lowercase)
        useragent: navigator.userAgent || ''
      });

      await fetch(scriptUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        mode: 'no-cors'
      , body });

      form.reset();
      showMessage('Thanks! You’re subscribed.');
      submitBtn.textContent = 'Subscribed';
    } catch (err) {
      console.error(err);
      showMessage('Sorry—couldn’t save right now. Please try again.');
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }

    return false; // extra guard against navigation
  }, { passive: false });
});
</script>




  <!-- Small UX enhancements -->
  <script>
  // add shadow to header after first pixels scrolled
  (function () {
    const header = document.querySelector('.site-header');
    const onScroll = () => header.classList.toggle('is-scrolled', window.scrollY > 2);
    onScroll(); // initialize
    window.addEventListener('scroll', onScroll, { passive: true });

    // mobile drawer (optional)
    const btn = document.querySelector('.menu-btn');
    const drawer = document.getElementById('mobile-drawer');
    if (btn && drawer) {
      btn.addEventListener('click', () => {
        const isOpen = !drawer.hasAttribute('hidden');
        drawer.toggleAttribute('hidden');
        btn.setAttribute('aria-expanded', String(!isOpen));
        document.body.style.overflow = isOpen ? '' : 'hidden'; // prevent background scroll
      });
      // close drawer on ESC
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !drawer.hasAttribute('hidden')) {
          drawer.setAttribute('hidden','');
          btn.setAttribute('aria-expanded','false');
          document.body.style.overflow = '';
        }
      });
    }
  })();
  </script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('request-form');
  if (!form) { console.warn('[request-med] form not found'); return; }

  const drugInput  = document.getElementById('request-drug');
  const emailInput = document.getElementById('request-email');
  const hint       = document.getElementById('request-hint');
  const submitBtn  = form.querySelector('button[type="submit"]');

  function show(msg) { if (hint) hint.textContent = msg; }

  // x-www-form-urlencoded
  const toForm = (data) =>
    Object.entries(data).map(([k,v]) => encodeURIComponent(k)+'='+encodeURIComponent(v)).join('&');

  console.log('[request-med] handler attached');

  form.addEventListener('submit', async function (e) {
    e.preventDefault(); e.stopPropagation();

    const drug  = (drugInput.value  || '').trim();
    const email = (emailInput.value || '').trim();

    if (!drug)  { show('Please enter a medication name.'); drugInput.focus();  return false; }
    if (!email) { show('Please enter a valid email.');     emailInput.focus(); return false; }

    const original = submitBtn.textContent;
    submitBtn.disabled = true; submitBtn.textContent = 'Saving…'; show('');

    try {
      const scriptUrl = (window.PAGE_CONFIG && window.PAGE_CONFIG.scriptUrl) || '';
      const body = toForm({
        email,
        drug,
        source: 'request_med',
        useragent: navigator.userAgent || ''
      });

      await fetch(scriptUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        mode: 'no-cors',
        body
      });

      form.reset();
      show('Got it! We’ll email you when this medication is available.');
      submitBtn.textContent = 'Request saved';
    } catch (err) {
      console.error(err);
      show('Sorry—couldn’t save right now. Please try again.');
      submitBtn.disabled = false; submitBtn.textContent = original;
    }

    return false;
  }, { passive: false });
});
</script>


</body>
</html>
